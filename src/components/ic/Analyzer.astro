<script>
	import { deriveCSSSelector } from './element-selector';
	import { ICElement } from './ic-element';
	import { ledGroup } from './led-group';
	import { message } from './message';

	class ICAnalyzer extends ICElement {
		protected render() {
			this.classList.add('panel');

			this.insertAdjacentHTML(
				'beforeend',
				ledGroup({
					className: 'analyze',
					groupName: 'analyze',
					checked: sessionStorage.getItem('ic-analyzer-mode') || 'animation',
					alternatives: [
						
						{
							label: 'Analyze capturing',
							value: 'capture',
							id: 'capture',
						},
						{
							label: 'Analyze animations',
							value: 'animation',
							id: 'animation',
						},
					],
				})
			);
			this.addEventListener('change', (e) => {
				sessionStorage.setItem('ic-analyzer-mode', (e.target as HTMLInputElement).value);
			});
			self.addEventListener('ic-update-error', (e) => {
				const errorDetails = (e as CustomEvent).detail;
				const where =
					errorDetails.root.parentElement || errorDetails.features.scoped
						? errorDetails.root
						: errorDetails.root.ownerDocument;
				message(
					'error',
					`Update callback for view transition on <b>${where.ownerDocument ? deriveCSSSelector(where) : 'document'}</b>[ðŸ–¶] rejected.<br>${errorDetails.error}.`,
					[where]
				);
			});

			self.addEventListener('ic-ready-error', (e) => {
				const errorDetails = (e as CustomEvent).detail;
				const where =
					errorDetails.root.parentElement || errorDetails.features.scoped
						? errorDetails.root
						: errorDetails.root.ownerDocument;
				message(
					'error',
					`${errorDetails.features.crossDocument ? 'Cross-document' : 'Same-document'} view transition on <b>${where.ownerDocument ? deriveCSSSelector(where) : 'document'}</b>[ðŸ–¶] failed.<br>${errorDetails.error}.`,
					[where]
				);
			});
		}
	}
	customElements.define('vtbag-ic-analyzer', ICAnalyzer);
</script>

<style is:global>
	@layer components {
		vtbag-ic-analyzer {
			display: block;
			.input-led-group.analyze div {
				display: flex;
				justify-content: space-around;
			}
		}
	}
</style>
