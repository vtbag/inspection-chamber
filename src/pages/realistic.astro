---

---

<html lang="en">
	<head>
		<title>Animations Test iframe</title>
		<meta charset="UTF-8" />
		<link rel="expect" href="#body" blocking="render" />
		<style is:inline>
			button:hover {
				transform: translateY(-4px);
				border: 4px solid greenyellow !important;
			}
			:root[data-page='0'] {
				--realistic-types: image-expand capture-old;
			}
			:root[data-page='1'] {
				--realistic-types: image-expand capture-new;
			}
			@view-transition {
				navigation: auto;
				types: foo;
			}
			:root,
			body {
				margin: 0;
				padding: 0;
				scrollbar-gutter: stable;
			}
			:root {
				color-scheme: dark light;
				background-color: light-dark(#eee, #222);
				color: light-dark(#111, #eee);
				view-transition-name: none;
			}
			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}
			h1 {
				width: fit-content;
				margin: 0 auto;
				transform: rotateZ(10deg);
			}
			#scope {
				view-transition-scope: auto;
			}
			header {
				view-transition-group: contain;
				view-transition-name: header;
			}
			:root header p {
				view-transition-name: ¶;
			}
			header p {
				view-transition-name: paragraph;
			}

			div:nth-of-type(1) {
				border: 2px solid darkgreen;
				border-radius: 1px;
			}
			body.expanded div:nth-of-type(1) {
				border: 1px solid blue;
				border-radius: 4px 2px;
			}
			main {view-transition-name: main;}
			aside {
				contain: layout;
				height: fit-content;
				width: fit-content;
				margin-inline: auto;
				margin-bottom: 1rem;
				padding: 1rem;
				outline: 2px solid #444;
				border-radius: 12px;
				box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
				view-transition-group: contain;
				view-transition-name: aside;
				span::before,
				span::after {
					content: ' ';
					padding: 8px;
				}
				span {
					view-transition-class: letter;
				}
				span:first-child {
					view-transition-class: letter first;
				}
				span:last-child {
					view-transition-class: last letter with many classes;
				}
			}

			#\!empty {
				view-transition-name: empty;
			}
			::view-transition-group(empty),
			::view-transition-new(empty),
			::view-transition-old(empty) {
				animation-name: none;
			}

			::view-transition-group(*) {
				animation-duration: calc(5 * var(--vtbag-ic-animation-speed, 1) * 50ms);
			}
			::view-transition-old(h1\!),
			::view-transition-new(h1\!) {
				height: 100%;
				width: auto;
				animation-delay: 20ms;
			}
			::view-transition-old(root),
			::view-transition-new(root) {
				height: 100%;
				width: 100%;
			}
			::view-transition-group(empty) {
				transition:
					200ms ease-in-out left,
					300ms linear scale;
				left: -50px;
				scale: 2;
				@start-state {
					left: 0;
					scale: 1;
				}
			}
			section:nth-of-type(1) {
				view-transition-group: header;
			}
			i {
				view-transition-group: first-section;
			}
			u {
				view-transition-name: strike;
			}
			:active-view-transition-type(capture-old) {
				i {
					view-transition-name: coi;
				}
				b {
					view-transition-name: cob;
				}
			}

			:active-view-transition-type(capture-new) {
				i {
					view-transition-name: cni;
				}
				b {
					view-transition-name: cnb;
				}
			}
			:active-view-transition-type(shuffle-old) {
				aside {
					view-transition-name: oaside;
				}
				:active-view-transition-type(shuffle-new) {
					aside {
						view-transition-name: naside;
					}
				}
			}
			::view-transition-old(expand-button):hover,
			::view-transition-new(expand-button):hover {
				border: 4px solid greenyellow !important;
				border-radius: 12px;
			}
			::view-transition-old(div) {
				animation-name: none;
			}
			h1::before,
			h1::after {
				content: '!';
				view-transition-name: match-element;
				view-transition-class: before-or-after;
				view-transition-group: nearest;
			}
			section {
				view-transition-name: section;
			}
			[style*='--vtn:'] {
				view-transition-name: var(--vtn);
			}

			section:nth-of-type(2) {
				view-transition-name: none;
				* {
					view-transition-name: none;
				}
			}
			section:nth-of-type(3) {
				view-transition-name: section3;
				view-transition-group: contain;
				span {
					view-transition-name: match-element;
					view-transition-group: contain;
					> * {
						view-transition-name: cob;
						view-transition-scope: auto;
					}
				}
			}
		</style>
		<meta name="viewport" content="width=device-width, minimum-scale=1.0" />
		<script is:inline src="/attach.js"></script>
	</head>
	<body id="body">
		<main
			style="max-width: 800px; margin: 0 auto; padding: 2rem; font-family: system-ui, sans-serif;"
		>
			<header style="text-align: center; margin-bottom: 3rem;">
				<h1
					style="view-transition-name: h1\\!; font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(45deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
				>
					Welcome to Our Platform
				</h1>
				<section style="--vtn: first-section;">
					<a href="/realistic/">Click me</a><span id="scope">
						Holla, Lorem <i>ipsum</i>
						<b>dolor</b> sit <u>amet</u> consectetur adipisicing elit. Suscipit magni ex vero
						commodi neque et adipisci quod aperiam facere. Fuga dicta pariatur officiis repellat
						laudantium provident tenetur consectetur adipisci cumque!</span
					>
				</section>
				<p
					style="font-size: 1.25rem; color: light-dark(#5f513f, #a0aec0); max-width: 600px; margin: 0 auto;"
				>
					Discover amazing features and unlock your potential with our innovative solutions.
				</p>
				<p style="view-transition-name: other;">This is another paragraph.</p>
				<kbd id="!empty">?</kbd>
			</header>
			<div style="text-align: center; margin-bottom: 2rem; view-transition-name: div; border: 2px solid darkgreen; border-radius: 4px;">
				<img
					id="bot"
					src="/bot1.png"
					alt="Featured"
					style="view-transition-name: img; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 100%; height: auto;view-transition-group: div"
				/><img
					src="/heroine.png"
					id="heroine"
					style="display:none; view-transition-name: img; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 100%; height: auto;view-transition-group: div"
				/>
			</div>

			<div style="text-align: center;">
				<button
					id="expand-button"
					style="view-transition-name: expand-button; background: linear-gradient(45deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 1rem 2rem; font-size: 1.1rem; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: transform 0.2s;"
				>
					Expand Image
				</button>
			</div>

			<section style="margin-bottom: 3rem;">
				<h2 style="font-size: 2rem; margin-bottom: 1rem; color: light-dark(#1d170f,#e2e8f0);">
					Why Choose Us?
				</h2>
				<p style="line-height: 1.8; color: light-dark(#342a1f,#cbd5e0); margin-bottom: 1rem;">
					We believe in creating exceptional experiences that make a difference. Our platform is
					designed with you in mind, offering intuitive tools and powerful features that help you
					achieve your goals faster.
				</p>
				<p style="line-height: 1.8; color: light-dark(#342a1f,#cbd5e0);">
					Join thousands of satisfied users who have transformed their workflow and discovered new
					possibilities with our cutting-edge technology.
				</p>
			</section>
			<script is:inline>
				const h1 = document.querySelector('h1');
				const expand = document.getElementById('expand-button');
				const img1 = document.getElementById('bot');
				const img2 = document.getElementById('heroine');
				const link = document.querySelector('a');
				const num = parseInt(new URLSearchParams(location.search).get('cacheBust') ?? '0', 10);
				link.href = '/realistic/?cacheBust=' + (num + 1);
				if (num && num & 1) {
					document.head.insertAdjacentHTML(
						'beforeend',
						`
						<style>@view-transition{
							navigation: auto;
							types: cross-document image-expand capture-new;
						}</style>`
					);
					h1.innerText = 'Welcome';
					img1.style.display = 'none';
					img2.style.display = 'inline';
					if (expand) expand.textContent = 'Shrink image';
					document.body.classList.add('expanded');

					const header = document.querySelector('header');
					header.appendChild(header.firstElementChild);
				} else {
					document.head.insertAdjacentHTML(
						'beforeend',
						`
						<style>@view-transition{
							navigation: auto;
							types: cross-document image-expand capture-old;
						}</style>`
					);
				}
			</script>
			<aside>
				<span style="view-transition-name: \\@lpha">a</span><span
					style="view-transition-name: bravo-\\$">b</span
				><span style="view-transition-name: \\!charlie">c</span><span
					style="view-transition-name: delta\\+item">d</span
				><span style="view-transition-name: \\'écho\\'">e</span><span
					style="view-transition-name: foxtrot-elem">f</span
				><span style="view-transition-name: golf">g</span><span
					style="view-transition-name: hotel-symbol">h</span
				><span style="view-transition-name: india">i</span><span
					style="view-transition-name: juliett-char">j</span
				><span style="view-transition-name: kilo">k</span><span
					style="view-transition-name: lima-element">l</span
				><span
					style="view-transition-name: mike; display: inline-block; position: relative; z-index: 14; transform: translateX(-90px);"
					>m</span
				><span style="view-transition-name: november-item">n</span><span
					style="view-transition-name: !oscar">o</span
				><span style="view-transition-name: papa-symbol">p</span><span
					style="view-transition-name: quebec">q</span
				><span style="view-transition-name: romeo-char">r</span><span
					style="view-transition-name: some-extra-ordinary-long-view-transition-name">s</span
				><span style="view-transition-name: tango-element">t</span><span
					style="view-transition-name: uniform">u</span
				><span style="view-transition-name: victor-item">v</span><span
					style="view-transition-name: whiskey; view-transition-group: main">w</span
				><span style="view-transition-name: xray-symbol">x</span><span
					style="view-transition-name: yankee">y</span
				><span style="view-transition-name: zulu-char">z</span>
			</aside>

			<button
				id="shuffle-button"
				style="view-transition-name: shuffle-button; background: linear-gradient(45deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 1rem 2rem; font-size: 1.1rem; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: transform 0.2s;margin-inline:auto; display:block;"
			>
				Shuffle
			</button>
			<section>
				<p>
					<span><b>Lots</b> of <u>DOM</u> <i>nodes</i></span>
					<span>that</span> are <span>removed</span> from <span>the sparse tree</span>
				</p>
			</section>
			<section>
				<p>
					<span></span><span><b>Lots</b> of <u>DOM</u> <i>nodes</i></span>
					<span>that</span> are <span>removed</span> from <span>the sparse tree</span>
				</p>
			</section>

			<script>
				import { mayStartViewTransition } from '@vtbag/utensil-drawer/may-start-view-transition';

				const nested = () => {
					const h1 = document.querySelector('h1')!;
					const expand = document.getElementById('expand-button');
					const img1 = document.getElementById('bot')!;
					const img2 = document.getElementById('heroine')!;
					let isExpanded = false;
					const shuffle = document.getElementById('shuffle-button')!;
					const aside = document.querySelector('aside')!;

					expand?.addEventListener('click', () => {
						const transition = mayStartViewTransition!({
							update() {
								transition.types?.add('capture-new');
								transition.types?.delete('capture-old');
								if (isExpanded) {
									h1.innerText = 'Welcome to Our Platform';
									img2.style.display = 'none';
									img1.style.display = 'inline';
									if (expand) expand.textContent = 'Expand the small image';
								} else {
									h1.innerText = 'Welcome';
									img1.style.display = 'none';
									img2.style.display = 'inline';
									if (expand) expand.textContent = 'Shrink image';
								}
								document.body.classList.toggle('expanded', !isExpanded);

								isExpanded = !isExpanded;
								const header = document.querySelector('header');
								header!.appendChild(header!.firstElementChild!);
							},
							types: ['image-expand', 'capture-old'],
						});

						transition.updateCallbackDone.catch((e) => console.error('Update callback failed:', e));
						transition.ready.then(() => {
							const animation = document.documentElement.animate(
								[
									{ offset: 0, accentColor: 'black' },
									{ offset: 1, accentColor: 'white' },
								],
								{ duration: 300, pseudoElement: '::view-transition-old(img)' }
							);
							transition.finished.then(() => animation.cancel());
						});
						transition.finished.catch((e) => console.error(e));
					});

					shuffle?.addEventListener('click', () => {
						const transition = mayStartViewTransition(
							{
								update() {
									transition.types?.add('shuffle-new');
									transition.types?.delete('shuffle-old');
									for (let i = aside.children.length; i >= 0; i--) {
										aside.appendChild(aside.children[~~(Math.random() * i)]);
									}
								},
								types: ['shuffle-letters', 'shuffle-old'],
							},
							{ scope: aside, useTypesPolyfill: 'always' }
						);
					});
				};

				callNested();

				function callNested() {
					nested();
				}
			</script>
		</main>
	</body>
</html>
