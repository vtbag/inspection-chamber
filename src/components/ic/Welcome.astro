<script>
	import { ICElement } from './ic-element';

	class ICWelcome extends ICElement {
		render() {
			this.classList.add('panel');
			const viewTransitionSupport = 'ViewTransition' in window;
			const sameDocumentViewTransitions = 'startViewTransition' in document;
			const crossDocumentViewTransitions = 'onpageswap' in window;
			const scopedViewTransitions = 'startViewTransition' in document.documentElement;
			const activeViewTransitionProperty = 'activeViewTransition' in document;
			const viewTransitionTypes = 'ViewTransitionTypeSet' in window;
			const waitUntil = 'waitUntil' in window.ViewTransition?.prototype;
			const transitionRoot = 'transitionRoot' in window.ViewTransition?.prototype;
			const nestedViewTransitionGroups = CSS.supports('view-transition-group', 'contain');
			const viewTransitionClass = CSS.supports('view-transition-class', 'none');
			const viewTransitionName = CSS.supports('view-transition-name', 'none');
			const viewTransitionScope = CSS.supports('view-transition-scope', 'none');
			const navigationAPI = 'navigation' in window;
			this.innerHTML = `<details ${localStorage.getItem('vtbag-ic-welcome-closed') !== 'yes' ? 'open' : ''}><summary>Welcome</summary>
<p>
The Inspection Chamber is a developer tool for putting your view transitions through their paces. Debug view transitions with clarity instead of guesswork.
</p>

<h4>Support for view transitions</h4>
<p>The Inspection Chamber checks for support of various View Transition API features. Here are the results for your current browser:
	<ul class="feature-list">
	<li class="${viewTransitionSupport ? 'success' : 'fail'}"><span>View transitions</span></li>	
	<li class="${sameDocumentViewTransitions ? 'success' : 'fail'}"><span>Same-document view transitions</span></li>
	<li class="${crossDocumentViewTransitions ? 'success' : 'fail'}"><span>Cross-document view transitions</span></li>
	<li class="${nestedViewTransitionGroups ? 'success' : 'fail'}"><span>Nested view transition groups</span></li>
	<li class="${scopedViewTransitions ? 'success' : 'fail'}"><span>Scoped view transitions</span></li>
	</ul>
<details><summary class="secondary">More details</summary>
	<ul class="feature-list">
	<li class="${viewTransitionName ? 'success' : 'fail'}"><span>view-transition-name CSS property</span></li>
	<li class="${viewTransitionClass ? 'success' : 'fail'}"><span>view-transition-class CSS property</span></li>
	<li class="${viewTransitionScope ? 'success' : 'fail'}"><span>view-transition-scope CSS property</span></li>
	<li class="${viewTransitionTypes ? 'success' : 'fail'}"><span>View transition types</span></li>
	<li class="${activeViewTransitionProperty ? 'success' : 'fail'}"><span>activeViewTransition property</span></li>
	<li class="${transitionRoot ? 'success' : 'fail'}"><span>ViewTransition.prototype.transitionRoot</span></li>
	<li class="${waitUntil ? 'success' : 'fail'}"><span>ViewTransition.prototype.waitUntil</span></li>
	<li class="${navigationAPI ? 'success' : 'fail'}"><span>Navigation API</span></li>
	</ul>
</details>
</p>
<h4>Basic Usage</h4>
<p>
Select "Analyze animations" and "Freeze", then start a view transition on your page, and the Inspection Chamber will reveal its details. To focus on the capture phase rather than animation, select "Analyze capturing". See the <a href="https://vtbag.dev/tools/inspection-chamber/" target="_blank" rel="noopener noreferrer">full user manual</a> for more information. 
</p>
<h4>Docking vs Window Mode</h4>
<p>
Press and hold the Chamber's drag handle to switch between docking mode and window mode. The window can be freely resized and moved without changing the viewport or canceling transitions.
</p>
<h4>Word of Warning for the Impatient</h4>
<p>
Be aware that the View Transition API cancels all active view transitions whenever the viewport size changes. Open DevTools/Inspector and resize the Chamber before starting any view transitions to avoid unexpected resets. Green drag handles are safe to use. Orange handles signal that resizing will cancel active view transitions. 
</p>
</details>`;
			this.firstElementChild!.addEventListener('toggle', (e) => {
				const details = e.target as HTMLDetailsElement;
				localStorage.setItem('vtbag-ic-welcome-closed', details.open ? 'no' : 'yes');
			});
		}
	}
	customElements.define('vtbag-ic-welcome', ICWelcome);
</script>

<style is:global>
	@import './styles/details.css';
	@layer components {
		vtbag-ic-welcome {
			display: block;
			padding: 0.5rem 1rem;

			.feature-list {
				font-weight: 800;
				font-family: system-ui, sans-serif;
				list-style: none;
				padding-left: 0;
				li {
					padding-left: 1.5em;
					margin-bottom: 0.5em;
					color: light-dark(#333333, #cccccc);
				}
				li.success::before {
					content: '✔ ';
					color: green;
					font-weight: bold;
					margin-left: -1.5em;
					margin-right: 0.5em;
				}
				li.fail {
					&::before {
						text-decoration: none;
						content: '✖ ';
						color: red;
						font-weight: bold;
						margin-left: -1.5em;
						margin-right: 0.5em;
					}
					span {
						text-decoration: line-through;
					}
				}
			}
		}
	}
</style>
